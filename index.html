<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat_with_model</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
    :root {
        /* åŸºç¡€é¢œè‰² - æŸ”å’Œä¸”é«˜è´µ */
        --color-primary: #1F3B4D;        /* æ·±ç°è“/æ·±æµ·è“ - ç”¨äºä¸»è¦æ–‡æœ¬/æ ‡é¢˜ */
        --color-accent: #007B9A;         /* å¼ºè°ƒè‰² - ç”¨äºæŒ‰é’®/é«˜äº® */
        --color-text-dark: #2C3E50;      /* æ·±è‰²æ–‡æœ¬ */
        --color-text-light: #5B6D7A;     /* æŸ”å’Œæ¬¡è¦æ–‡æœ¬ */

        /* èƒŒæ™¯é¢œè‰² - æ¸©æš–çš„ç±³ç™½ */
        --bg-main: #F7F7F8;              /* ä¸»èƒŒæ™¯ */
        --bg-sidebar: #FFFFFF;           /* ä¾§è¾¹æ èƒŒæ™¯ï¼ˆçº¯ç™½ï¼Œå¢åŠ å¯¹æ¯”ï¼‰ */
        --bg-chat-bubble-ai: #EAF0F4;    /* AIæ°”æ³¡ - æµ…ç°è“ */
        --bg-chat-bubble-user: #FFFFFF;  /* ç”¨æˆ·æ°”æ³¡ - çº¯ç™½ */
        --bg-input: #FFFFFF;             /* è¾“å…¥åŒºèƒŒæ™¯ */

        /* è¾¹æ¡†ä¸åˆ†éš”çº¿ */
        --border-subtle: #D8DCE0;        /* æŸ”å’Œè¾¹æ¡† */

        /* é˜´å½±ï¼ˆæå‡å±‚æ¬¡æ„Ÿï¼‰ */
        --shadow-subtle: 0 4px 12px rgba(0, 0, 0, 0.06);
        --shadow-elevated: 0 10px 30px rgba(0, 0, 0, 0.12);
        --shadow-accent: 0 4px 10px rgba(0, 123, 154, 0.25);
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        /* ä½¿ç”¨æ›´ç²¾è‡´çš„å­—ä½“æ ˆï¼Œæ•´ä½“å­—ä½“å˜ç»† */
        font-family: 'Georgia', 'Times New Roman', serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial;
        background-color: var(--bg-main);
        color: var(--color-text-dark);
        display: flex;
        height: 100vh;
        overflow: hidden;
        font-weight: 300;
    }

    /* === ä¾§è¾¹æ  (Sidebar) === */
    aside {
        width: 280px;
        background-color: var(--bg-sidebar);
        border-right: 1px solid var(--border-subtle);
        box-shadow: 2px 0 5px rgba(0,0,0,0.02); /* è½»å¾®é˜´å½± */
        display: flex;
        flex-direction: column;
        padding: 20px;
        transition: width 0.3s ease-in-out, padding 0.3s ease-in-out;
        position: relative; /* ç”¨äºå®šä½æŠ˜å æŒ‰é’® */
    }

    .new-chat-btn {
        border: none;
        border-radius: 8px;
        padding: 15px;
        background: var(--color-accent);
        color: #FFFFFF;
        cursor: pointer;
        text-align: left;
        margin-bottom: 30px;
        margin-top: 10px;
        transition: background-color 0.3s, transform 0.1s;
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 500;
        font-size: 16px;
        box-shadow: var(--shadow-accent);
    }

    .new-chat-btn:hover {
        background-color: #0093ba;
        transform: translateY(-1px);
    }

    .history-list { flex: 1; overflow-y: auto; }

    .history-item {
        padding: 14px 12px;
        border-radius: 6px;
        color: var(--color-text-dark);
        cursor: pointer;
        font-size: 14px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        margin-bottom: 6px;
        transition: background-color 0.2s, color 0.2s;
        font-weight: 400;
    }
    .history-item:hover {
        background-color: var(--bg-chat-bubble-ai);
        color: var(--color-primary);
    }
    .sidebar-collapsed aside {
        width: 65px; /* æ”¶èµ·åçš„å®½åº¦ */
        padding: 20px 10px; /* å‡å°‘å¡«å…… */
    }
    .sidebar-collapsed aside > div:nth-child(3), /* å†å²è®°å½•æ ‡é¢˜ */
    .sidebar-collapsed .history-list {
        display: none;
    }

    /* è°ƒæ•´æ”¶èµ·çŠ¶æ€ä¸‹çš„ã€æ–°å»ºä¼šè¯ã€‘æŒ‰é’® */
    .sidebar-collapsed .new-chat-btn {
        width: 45px;      /* æŒ‰é’®å®½åº¦å‡å° */
        height: 45px;     /* æŒ‰é’®é«˜åº¦å‡å° */
        padding: 0;       /* ç§»é™¤å†…è¾¹è· */
        border-radius: 50%; /* å˜æˆåœ†å½¢ */
        justify-content: center; /* å›¾æ ‡å±…ä¸­ */
        gap: 0; /* ç§»é™¤å›¾æ ‡æ—çš„é—´è· */
        margin-bottom: 10px; /* æ”¶èµ·åé—´è·æ›´ç´§å‡‘ */
    }

    /* éšè—æ”¶èµ·çŠ¶æ€ä¸‹çš„æŒ‰é’®æ–‡æœ¬*/
    .sidebar-collapsed .new-chat-btn .new-chat-text {
        display: none;
    }

    /* ç¡®ä¿å›¾æ ‡åœ¨åœ†å½¢æŒ‰é’®ä¸­å±…ä¸­ */
    .sidebar-collapsed .new-chat-btn svg {
        width: 20px;
        height: 20px;
    }

    /* æŠ˜å /å±•å¼€ æŒ‰é’®æ ·å¼ */
    .toggle-sidebar-btn {
        position: absolute;
        top: 50%;
        right: -14px; /* æ”¾åœ¨ä¾§è¾¹æ å³ä¾§è¾¹ç¼˜å¤– */
        transform: translateY(-50%);
        width: 28px;
        height: 28px;
        background-color: var(--color-accent);
        border: none;
        border-radius: 50%;
        box-shadow: var(--shadow-subtle);
        cursor: pointer;
        z-index: 20;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.3s, transform 0.3s;
        color: white;
    }

    .toggle-sidebar-btn:hover {
        background-color: #0093ba;
    }

    .toggle-sidebar-btn svg {
        transition: transform 0.3s;
        transform: rotate(0deg);
    }
    .sidebar-collapsed .toggle-sidebar-btn svg {
        transform: rotate(180deg);
    }
    main { flex: 1; display: flex; flex-direction: column; position: relative; }

    .top-bar {
        height: 70px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-bottom: none;
        font-weight: 500;
        color: var(--color-primary);
        background: var(--bg-sidebar);
        box-shadow: var(--shadow-subtle);
        z-index: 10;
        font-size: 18px;
    }

    .messages-container {
        flex: 1;
        overflow-y: auto;
        padding-bottom: 160px;
        padding-top: 20px;
        scroll-behavior: smooth;
    }

    .message { padding: 30px 0; width: 100%; }

    .message.ai {
        background-color: var(--bg-chat-bubble-ai);
        border-bottom: 1px solid var(--border-subtle);
        border-top: 1px solid var(--border-subtle);
    }

    .message-content {
        max-width: 860px;
        margin: 0 auto;
        display: flex;
        gap: 24px;
        padding: 0 30px;
        line-height: 1.8;
        font-size: 16.5px;
    }

    /* å¤´åƒæ ·å¼ */
    .avatar {
        width: 38px; height: 38px;
        border-radius: 50%;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        color: white;
        font-size: 16px;
        background: #5D9CEC;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .avatar.user { background: #5D9CEC; }
    .avatar.ai { background: var(--color-accent); }

    .text { flex: 1; min-width: 0; padding-top: 0; }

    /* === Markdown å’Œä»£ç æ ·å¼ === */
    .text h1, .text h2, .text h3 {
        color: var(--color-primary);
        font-weight: 500;
        margin-top: 1.5em;
        margin-bottom: 0.8em;
    }
    .text h2 {
        border-bottom: 1px solid var(--border-subtle);
        padding-bottom: 0.3em;
        font-size: 1.5em;
    }
    .text h3 { font-size: 1.2em; }

    .text pre {
        background: #fcfcfc;
        padding: 20px;
        border-radius: 10px;
        overflow-x: auto;
        margin: 20px 0;
        color: var(--color-text-dark);
        border: 1px solid #e9e9e9;
        box-shadow: 0 2px 4px rgba(0,0,0,0.03);
    }
    .text code {
        font-family: 'Consolas', 'Courier New', monospace;
        background-color: #f0f0f0;
        padding: 3px 6px;
        border-radius: 4px;
        font-size: 0.9em;
        color: var(--color-primary);
        font-weight: 400;
    }
    .text pre code {
        background-color: transparent;
        padding: 0;
    }
    .text p { margin-bottom: 1.2em; }
    .text ul, .text ol {
        margin-bottom: 1.5em;
        margin-left: 1.5em;
        padding-left: 0.5em;
    }
    .text li { margin-bottom: 0.5em; }


    /* === åº•éƒ¨è¾“å…¥åŒº (Input Area) === */
    .input-container {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        /* æŸ”å’Œçš„æ¸å˜ï¼Œä½¿è¾“å…¥æ¡†æœ‰æµ®å‡ºæ•ˆæœ */
        background-image: linear-gradient(180deg, rgba(247, 247, 248, 0.05), var(--bg-main) 70%);
        padding: 40px 20px 40px 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

 .input-box-wrapper {
    width: 100%;
    max-width: 860px;
    position: relative;
    background-color: var(--bg-input);
    border-radius: 16px;
    box-shadow: var(--shadow-elevated);
    border: 1px solid var(--border-subtle);
    display: flex;
    align-items: stretch;
    padding: 16px 20px;
}

   textarea {
    width: 100%;
    background: transparent;
    border: none;
    color: var(--color-text-dark);
    font-size: 16px;
    resize: none;
    max-height: 200px;
    padding: 4px 0;
    padding-right: 80px;
    margin-right: 0;
    outline: none;
    font-family: inherit;
    line-height: 1.6;
    font-weight: 400;
}
.input-actions {
    position: absolute;
    bottom: 12px; /* è°ƒæ•´åˆ°åº•éƒ¨çš„è·ç¦» */
    right: 20px; /* è°ƒæ•´åˆ°å³ä¾§çš„è·ç¦» */
    display: flex;
    gap: 8px; /* æŒ‰é’®ä¹‹é—´çš„é—´è· */
    align-items: flex-end; /* ä½¿æŒ‰é’®ä¸åº•éƒ¨å¯¹é½ */
}

.attach-btn {
    background: #AAB7B8; /* æŸ”å’Œçš„ç°è‰² */
    border: none;
    cursor: pointer;
    padding: 10px;
    border-radius: 8px;
    color: white;
    transition: background-color 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.attach-btn:hover { background-color: #8D99A1; }

/* è°ƒæ•´å‘é€æŒ‰é’®çš„å°ºå¯¸ä»¥é…åˆæ–°çš„å¸ƒå±€ */
.send-btn {
    width: 40px;
    height: 40px;
    padding: 10px; /* ä¿æŒå†…è¾¹è· */
}

    .send-btn {
        background: var(--color-accent);
        border: none;
        cursor: pointer;
        padding: 10px;
        border-radius: 8px;
        color: white;
        transition: background-color 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 5px rgba(0, 123, 154, 0.3);
    }
    .send-btn:hover { background-color: #0093ba; }
    .send-btn:disabled { background-color: #ccc; cursor: not-allowed; box-shadow: none; }
    .send-btn svg { width: 20px; height: 20px; fill: currentColor; }

    .footer-tip {
        font-size: 13px;
        color: var(--color-text-light);
        margin-top: 15px;
        text-align: center;
    }

    /* === åŠ è½½åŠ¨ç”»æ ·å¼ === */
    .loading-dots {
        display: flex;
        gap: 8px;
        align-items: center;
        padding: 5px 0;
    }
    .dot {
        width: 10px;
        height: 10px;
        background-color: var(--color-accent);
        border-radius: 50%;
        opacity: 0.9;
        animation: bounce 1.2s infinite ease-in-out both;
    }
    .dot:nth-child(1) { animation-delay: -0.32s; }
    .dot:nth-child(2) { animation-delay: -0.16s; }
    .dot:nth-child(3) { animation-delay: 0s; }

    @keyframes bounce {
        0%, 80%, 100% { transform: scale(0); }
        40% { transform: scale(1.0); }
    }
</style>
</head>
<body>

<aside>
    <button class="toggle-sidebar-btn" onclick="toggleSidebar()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
    </button>

    <button class="new-chat-btn" onclick="resetChat()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
        <span class="new-chat-text">æ–°å»ºä¼šè¯</span>
    </button>
    <div style="font-size: 18px; font-weight: 600; color: #2d3748; margin: 20px 0; padding-bottom: 10px; border-bottom: 2px solid #e2e8f0;">å†å²è®°å½•</div>
    <div class="history-list" id="history-list">
</div>
</aside>

    <main>
        <div class="top-bar"><span>An easy agent</span></div>
        <div class="messages-container" id="chatContainer">
        </div>

        <div class="input-container">
            <div class="input-box-wrapper">
                <textarea id="userInput" rows="1" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜..." oninput="autoResize(this)"></textarea>
                <div class="input-actions">
                <button id="attach-btn" class="attach-btn" onclick="attachFile()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7l-6 6M13 11l6-6M9 17h6M9 7h6M12 19v-4M12 5v4"/></svg>
                </button>
                    <input type="file" id="file-input" style="display: none;">
                <button class="send-btn" id="sendBtn" onclick="sendMessage()">
                    <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
                </button>
            </div>
        </div>
            <div class="footer-tip">AI å¯èƒ½ä¼šç”Ÿæˆä¸å‡†ç¡®çš„ä¿¡æ¯ï¼Œè¯·æ ¸å¯¹é‡è¦äº‹å®ã€‚</div>
        </div>
    </main>
    <script>

        function toggleSidebar() {
        document.body.classList.toggle('sidebar-collapsed');
    }
        const chatContainer = document.getElementById('chatContainer');
        const historyList=document.getElementById('history-list');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const attachButton = document.getElementById('attach-btn');
        const fileInput = document.getElementById('file-input');
        let eventSource=null;
        const API_ENDPOINT = "http://127.0.0.1:8000";
        let selectedFile=null
        let whether_load_history=0;
        let whether_use_file=0;
        let content="No content"
        let currentSessionId=0;
        const uid=localStorage.getItem('uid');
        async function LOAD_SUMMARY(){
                try{
                    const url = `${API_ENDPOINT}/api/chat/get_summary?uid=${encodeURIComponent(uid)}`;
                    const response=await fetch(url,{method:"GET"});
                     if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    var message=data.message;
                    historyList.innerHTML='';
                    for(let i=0;i<message.length;i++){
                        await addHistoryItem(message[i].summary, message[i].chat_id);
                    }
                }
                catch (error){
                    console.log(`é”™è¯¯ä¿¡æ¯ ${error.message},è¯·æ£€æŸ¥APIç«¯ç‚¹æ˜¯å¦è¿æ¥æˆåŠŸ`);
                }
            }
        document.addEventListener('DOMContentLoaded',function(){
            LOAD_SUMMARY();
        });

        let isGenerating = false;
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = textarea.scrollHeight + 'px';
        }

        // æ ¸å¿ƒå‘é€é€»è¾‘
        async function sendMessage() {
            const question = userInput.value.trim();
            if (!question || isGenerating) return;
            addMessage('user', question);
            userInput.value = '';
            userInput.style.height = 'auto';
            isGenerating = true;
            sendBtn.disabled = true;
            const loadingMessageDiv = createLoadingMessage();
            await fetchAIResponse(question, loadingMessageDiv);
            isGenerating = false;
            sendBtn.disabled = false;
            userInput.focus();
        }
        function createLoadingMessage() {
            const div = document.createElement('div');
            div.className = 'message ai';
            div.innerHTML = `
                <div class="message-content">
                    <div class="avatar ai">AI</div>
                    <div class="text">
                        <div class="loading-dots">
                            <div class="dot"></div>
                            <div class="dot"></div>
                            <div class="dot"></div>
                        </div>
                    </div>
                </div>
            `;
            chatContainer.appendChild(div);
            scrollToBottom();
            return div;
        }

        // å‘èµ·å®é™…çš„ API è¯·æ±‚å¹¶å¤„ç†å“åº”
        async function fetchAIResponse(question, messageDiv) {
            const textElement = messageDiv.querySelector('.text');

            try {
                if(whether_use_file===1){
                    const url1 = `${API_ENDPOINT}/api/chat/load_file`;
                    const formdata = new FormData();
                    formdata.append('question', question)
                    formdata.append('file', selectedFile)
                    const response = await fetch(url1, {
                        method: 'POST',
                        body: formdata,
                    });
                    let result = await response.json()
                    content=result.page_content
                }
                console.log(content)
                const url = `${API_ENDPOINT}/api/chat/get?question=${encodeURIComponent(question)}&content=${encodeURIComponent(content)}`;

                const response = await fetch(url, { method: 'GET' });
                const data = await response.json();
                eventSource=new EventSource(url);
                let fullMarkdownResponse = ''

                // æ£€æŸ¥ HTTP çŠ¶æ€ç å’Œè‡ªå®šä¹‰ code
                if (response.ok) {
                    const fullResponse = data.message || "AIæœªè¿”å›å†…å®¹ã€‚";
                    // æˆåŠŸåï¼Œæ›¿æ¢åŠ è½½åŠ¨ç”»ä¸ºæœ€ç»ˆå†…å®¹
                    textElement.innerHTML = marked.parse(fullResponse);
                } else {
                    const errorMsg = `API é”™è¯¯ (${data.code || response.status})ï¼š${data.detail || 'è¯·æ±‚å¤±è´¥æˆ–åç«¯è¿”å›ç»“æ„å¼‚å¸¸'}`;
                    textElement.innerHTML = marked.parse(`**æŠ±æ­‰ï¼Œè¯·æ±‚å¤±è´¥ã€‚**\n\n\`\`\`text\n${errorMsg}\n\`\`\``);
                }

            } catch (error) {
                console.error("Fetch error:", error);
                // ç½‘ç»œé”™è¯¯å¤„ç†
                textElement.innerHTML = marked.parse(`**ç½‘ç»œè¿æ¥é”™è¯¯ï¼š** æ— æ³•è¿æ¥åˆ° ${API_ENDPOINT}ã€‚è¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œã€‚`);
            }
            scrollToBottom();
        }

        //åˆ›å»ºæ–°å¯¹è¯å¹¶å°†å†å²ä¿å­˜åœ¨æ•°æ®åº“ä¸­
        async function post_history(human_history,ai_history){

            const data={
                chat_id:currentSessionId,
                human_message:human_history,
                ai_message:ai_history,
                uid:uid,
                whether_load_history:whether_load_history
            };
            console.log(currentSessionId);
            let body="";
            let summary;
            try {
                const url = `${API_ENDPOINT}/api/chat/store_history`;
                const response = await fetch(url, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    body = await response.json();
                    summary = body.summary;
                    if(whether_load_history===0){
                        await addHistoryItem(summary, body.chat_id);
                    }
                    whether_load_history=0;
                } else {
                    alert("ä¿å­˜å¤±è´¥");
                }
            } catch (error) {
                console.error("é”™è¯¯ï¼š", error);
            }
        }
        function addMessage(role, text) {
            const div = document.createElement('div');
            div.className = `message ${role}`;
            const contentHTML = role === 'ai' ? marked.parse(text) : text.replace(/\n/g, '<br>');
            div.innerHTML = `
                <div class="message-content">
                    <div class="avatar ${role}">${role === 'ai' ? 'ğŸ¤–' : 'ğŸ‘¤'}</div>
                    <div class="text">${contentHTML}</div>
                </div>
            `;
            chatContainer.appendChild(div);
            scrollToBottom();
        }
       async function addHistoryItem(summary,sessionId) {
            const div = document.createElement('div');
            div.className = 'history-item';
            div.textContent = summary;
            div.setAttribute('data-session-id', sessionId);
            div.addEventListener('click', loadHistory);
            historyList.prepend(div);
            setActiveHistory(div);
        }
        async function loadHistory(event) {
            const item = event.currentTarget;
            const sessionId = item.getAttribute('data-session-id');
            const title = item.textContent;
            setActiveHistory(item);
            chatContainer.innerHTML = '';
            currentSessionId = sessionId;
            try{
                const url=`${API_ENDPOINT}/api/chat/get_history_by_id?chat_id=${encodeURIComponent(currentSessionId)}&uid=${encodeURIComponent(uid)}`;
                const response=await fetch(url,{method:"GET"});
                const data=response.json();
                const result=await data;
                const ai_history=result.ai_history;
                const human_history=result.human_history;
                whether_load_history=1;
                for(let i=0;i<ai_history.length;i++){
                    addMessage('user',human_history[i]);
                    addMessage('ai',ai_history[i])
                }
            }
            catch (error){
                console.log(`é”™è¯¯çš„ä¿¡æ¯æ˜¯ ${error.message}`);
            }

        }
        function setActiveHistory(activeItem) {
            document.querySelectorAll('.history-item').forEach(item => {
                item.classList.remove('active');
            });
            if (activeItem) {
                 activeItem.classList.add('active');
            }
        }
        function scrollToBottom() {
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // ç›‘å¬å›è½¦å‘é€
        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        fileInput.addEventListener("change", async () => {
            try {

                if (fileInput.files.length > 0) {
                    selectedFile = fileInput.files[0];
                    alert("ä¸Šä¼ æˆåŠŸ");
                    await search_data_from_file('abc', selectedFile)
                }
            } catch (error) {
                alert("ä¸Šä¼ å¤±è´¥")
            }
        });
        function attachFile() {
            alert("è¯·ä¸Šä¼ ä¸€ä¸ªéœ€è¦çš„æ–‡ä»¶");
            fileInput.click();
        }
        async function search_data_from_file(question,file) {
            const url = `${API_ENDPOINT}/api/chat/load_file`;
            const formdata = new FormData();
            formdata.append('question', question)
            formdata.append('file', file)
            const response = await fetch(url, {
                method: 'POST',
                body: formdata,
            });
            let result = await response.json()
            if(result.code===200){
                whether_use_file=1;
            }
        }
        function resetChat() {
            if(confirm("ç¡®å®šè¦è·å–å½“å‰å¯¹è¯çš„æ‰€æœ‰å†…å®¹å—ï¼Ÿ")) {
                const ai = document.querySelectorAll('.message.ai .text');
                const ai_history=Array.from(ai);
                const human=document.querySelectorAll('.message.user .text');
                const human_history=Array.from(human);
                const chat_ai_message=ai_history.map(element=>element.textContent.trim());
                const chat_human_message=human_history.map(element=>element.textContent.trim());
                post_history(chat_human_message,chat_ai_message);
                whether_use_file=0;
                currentSessionId=0
                content="No content"
                chatContainer.innerHTML = '';
            }
        }
        window.addEventListener('beforeunload', function() {
            localStorage.removeItem('uid');
        });
    </script>
</body>
</html>